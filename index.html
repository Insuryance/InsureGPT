<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsureGPT - Real AI Insurance Analysis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-900: #111827;
            --gray-800: #1f2937;
            --gray-700: #374151;
            --gray-600: #4b5563;
            --gray-500: #6b7280;
            --gray-400: #9ca3af;
            --gray-300: #d1d5db;
            --gray-200: #e5e7eb;
            --gray-100: #f3f4f6;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-900) 100%);
            color: white;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            padding: 0 2rem;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            height: 70px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--gray-300);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-links a:hover, .nav-links a.active {
            color: white;
            background: rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Main Content */
        .main {
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Hero Section */
        .hero {
            padding: 4rem 0;
            text-align: center;
            background: radial-gradient(ellipse at center, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, white 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--gray-400);
            margin-bottom: 2.5rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .hero-feature {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .hero-feature i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Upload Section */
        .upload-section {
            padding: 4rem 0;
        }

        .upload-container {
            background: var(--gray-800);
            border: 2px dashed var(--gray-600);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            margin-bottom: 2rem;
        }

        .upload-container:hover, .upload-container.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: translateY(-2px);
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
        }

        .upload-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            color: var(--gray-400);
            margin-bottom: 1.5rem;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: var(--gray-700);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        /* Analysis Section */
        .analysis-section {
            padding: 2rem 0;
            display: none;
        }

        .analysis-section.active {
            display: block;
        }

        .progress-container {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: var(--gray-700);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            color: var(--gray-300);
            font-size: 0.9rem;
        }

        /* Results Section */
        .results-section {
            padding: 2rem 0;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .risk-score {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            font-size: 2rem;
            font-weight: 700;
            margin: 1rem auto;
            position: relative;
        }

        .risk-low { background: linear-gradient(135deg, var(--success), #059669); }
        .risk-medium { background: linear-gradient(135deg, var(--warning), #d97706); }
        .risk-high { background: linear-gradient(135deg, var(--danger), #dc2626); }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .result-card {
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            border-radius: 12px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .card-content {
            color: var(--gray-300);
        }

        .analysis-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .analysis-item:last-child {
            margin-bottom: 0;
        }

        .analysis-label {
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }

        .analysis-value {
            color: var(--gray-300);
        }

        .highlight {
            color: var(--primary);
            font-weight: 600;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        /* Loading Animation */
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-600);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .hero {
                padding: 2rem 0;
            }
            
            .upload-container {
                padding: 2rem 1rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <i class="fas fa-shield-alt"></i> InsureGPT
            </div>
            <ul class="nav-links">
    <li><a href="#home" class="active">Home</a></li>
    <li><a href="#analyze">Analyze</a></li>
    <li><a href="#" onclick="showHistory()">History</a></li>
    <li><a href="#features">Features</a></li>
    <li><a href="#about">About</a></li>
</ul>
            <a href="#analyze" class="btn btn-primary">
                <i class="fas fa-upload"></i> Analyze Policy
            </a>
        </nav>
    </header>

    <main class="main">
        <!-- Hero Section -->
        <section class="hero" id="home">
            <div class="container">
                <h1>Real AI Insurance Analysis</h1>
                <p>Upload your insurance policy and get comprehensive, accurate analysis powered by advanced AI. No more guesswork - get real insights tailored to your specific policy.</p>
                
                <div class="hero-features">
                    <div class="hero-feature">
                        <i class="fas fa-brain"></i>
                        <h3>AI-Powered Analysis</h3>
                        <p>Advanced OCR and NLP models extract and analyze every detail from your policy documents</p>
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-chart-line"></i>
                        <h3>Risk Assessment</h3>
                        <p>Comprehensive risk scoring based on actual policy terms and coverage gaps</p>
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-lightbulb"></i>
                        <h3>Smart Recommendations</h3>
                        <p>Personalized suggestions to optimize your coverage and reduce costs</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upload Section -->
        <section class="upload-section" id="analyze">
            <div class="container">
                <h2 class="text-center mb-3">Upload Your Insurance Policy</h2>
                <p class="text-center text-gray-400 mb-3">Supported formats: PDF, DOC, DOCX (Max 10MB)</p>
                
                <div class="upload-container" id="uploadContainer">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">Drop your policy document here</div>
                    <div class="upload-subtext">or click to browse files</div>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx">
                    <button class="btn btn-primary mt-2" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i> Choose File
                    </button>
                </div>

                <div class="file-info" id="fileInfo">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div class="file-name" style="font-weight: 600;"></div>
                            <div class="file-size" style="color: var(--gray-400); font-size: 0.9rem;"></div>
                        </div>
                        <button class="btn btn-primary" onclick="startAnalysis()">
                            <i class="fas fa-play"></i> Start Analysis
                        </button>
                    </div>
                </div>

                <div class="error-message" id="errorMessage"></div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section class="analysis-section" id="analysisSection">
            <div class="container">
                <div class="progress-container">
                    <div class="text-center">
                        <div class="spinner"></div>
                        <h3>Analyzing Your Policy</h3>
                        <p class="progress-text" id="progressText">Initializing analysis...</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="text-center mt-2">
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section" id="resultsSection">
            <div class="container">
                <div class="results-header">
                    <h2>Policy Analysis Results</h2>
                    <div class="risk-score" id="riskScore">
                        <span id="riskValue">-</span>
                    </div>
                    <p id="riskDescription">Overall Risk Assessment</p>
                </div>

                <div class="results-grid">
                    <!-- Policy Overview -->
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="card-title">Policy Overview</div>
                        </div>
                        <div class="card-content" id="policyOverview">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Coverage Analysis -->
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="card-title">Coverage Analysis</div>
                        </div>
                        <div class="card-content" id="coverageAnalysis">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Risk Assessment -->
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="card-title">Risk Assessment</div>
                        </div>
                        <div class="card-content" id="riskAssessment">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Recommendations -->
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="card-title">AI Recommendations</div>
                        </div>
                        <div class="card-content" id="recommendations">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Key Terms -->
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="card-title">Key Terms & Conditions</div>
                        </div>
                        <div class="card-content" id="keyTerms">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Financial Analysis -->
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="card-title">Financial Analysis</div>
                        </div>
                        <div class="card-content" id="financialAnalysis">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <button class="btn btn-secondary" onclick="resetAnalysis()">
                        <i class="fas fa-redo"></i> Analyze Another Policy
                    </button>
                    <button class="btn btn-primary" onclick="downloadReport()">
                        <i class="fas fa-download"></i> Download Report
                    </button>
                </div>
            </div>
        </section>
        <!-- Document History Section -->
<section class="history-section" id="historySection" style="display: none;">
    <div class="container">
        <h2 class="text-center mb-3">Document History</h2>
        <div id="documentHistory">
            <!-- Dynamic content -->
        </div>
        <div class="text-center mt-3">
            <button class="btn btn-secondary" onclick="hideHistory()">
                <i class="fas fa-arrow-left"></i> Back to Upload
            </button>
        </div>
    </div>
</section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Global variables
        let currentFile = null;
        let extractedText = '';
        let analysisResults = {};
        let storedDocuments = JSON.parse(localStorage.getItem('insuregpt-documents') || '[]');

        // DOM elements
        const fileInput = document.getElementById('fileInput');
        const uploadContainer = document.getElementById('uploadContainer');
        const fileInfo = document.getElementById('fileInfo');
        const errorMessage = document.getElementById('errorMessage');
        const analysisSection = document.getElementById('analysisSection');
        const resultsSection = document.getElementById('resultsSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressPercent = document.getElementById('progressPercent');

        // File upload handlers
        fileInput.addEventListener('change', handleFileSelect);
        uploadContainer.addEventListener('click', () => fileInput.click());
        uploadContainer.addEventListener('dragover', handleDragOver);
        uploadContainer.addEventListener('dragleave', handleDragLeave);
        uploadContainer.addEventListener('drop', handleDrop);

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                validateAndDisplayFile(file);
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadContainer.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadContainer.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadContainer.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                validateAndDisplayFile(file);
            }
        }

        function validateAndDisplayFile(file) {
            // Reset error message
            hideError();

            // Validate file type
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!validTypes.includes(file.type)) {
                showError('Please upload a PDF, DOC, or DOCX file.');
                return;
            }

            // Validate file size (10MB limit)
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showError('File size must be less than 10MB.');
                return;
            }

            // Display file info
            currentFile = file;
            displayFileInfo(file);
        }

        function displayFileInfo(file) {
            const fileName = document.querySelector('.file-name');
            const fileSize = document.querySelector('.file-size');
            
            fileName.textContent = file.name;
            fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
            
            fileInfo.classList.add('active');
        }
        function showHistory() {
    document.querySelector('.upload-section').style.display = 'none';
    document.getElementById('historySection').style.display = 'block';
    loadDocumentHistory();
}

function hideHistory() {
    document.getElementById('historySection').style.display = 'none';
    document.querySelector('.upload-section').style.display = 'block';
}

function loadDocumentHistory() {
    const historyContainer = document.getElementById('documentHistory');
    
    if (storedDocuments.length === 0) {
        historyContainer.innerHTML = '<p class="text-center text-gray-400">No documents uploaded yet.</p>';
        return;
    }
    
    const historyHTML = storedDocuments.map(doc => `
        <div class="result-card" style="margin-bottom: 1rem;">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div>
                    <div class="card-title">${doc.fileName}</div>
                    <div style="color: var(--gray-400); font-size: 0.9rem;">
                        Uploaded: ${new Date(doc.uploadDate).toLocaleDateString()} | 
                        Size: ${(doc.fileSize / 1024 / 1024).toFixed(2)} MB |
                        Risk Score: ${doc.analysis.riskScore || 'N/A'}
                    </div>
                </div>
            </div>
            <div class="card-content">
                <p><strong>Policy Type:</strong> ${doc.analysis.policyType || 'Not detected'}</p>
                <p><strong>Sum Insured:</strong> ${doc.analysis.sumInsured || 'Not specified'}</p>
                <button class="btn btn-primary" onclick="viewDocumentDetails(${doc.id})" style="margin-top: 1rem;">
                    View Details
                </button>
            </div>
        </div>
    `).join('');
    
    historyContainer.innerHTML = historyHTML;
}

function viewDocumentDetails(docId) {
    const doc = storedDocuments.find(d => d.id === docId);
    if (doc) {
        analysisResults = doc.analysis;
        extractedText = doc.textExtract;
        showResults();
    }
}

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('active');
        }

        function hideError() {
            errorMessage.classList.remove('active');
        }
        function showInvalidDocumentError() {
    analysisSection.classList.remove('active');
    document.querySelector('.upload-section').style.display = 'block';
    showError('This document does not appear to be an insurance policy. Please upload a valid insurance policy document that contains policy numbers, coverage details, and insurance terms.');
    }

        async function startAnalysis() {
            if (!currentFile) {
                showError('Please select a file first.');
                return;
            }

            // Hide upload section and show analysis
            document.querySelector('.upload-section').style.display = 'none';
            analysisSection.classList.add('active');

            try {
                // Extract text from document
                await extractTextFromFile(currentFile);
                
                // Analyze the extracted text
                await analyzeDocument(extractedText);
                
                // Show results
                showResults();
                
            } catch (error) {
                console.error('Analysis error:', error);
                showError('An error occurred during analysis. Please try again.');
            }
        }

        async function extractTextFromFile(file) {
            updateProgress(10, 'Extracting text from document...');

            if (file.type === 'application/pdf') {
                extractedText = await extractTextFromPDF(file);
            } else {
                // For DOC/DOCX files, we'll simulate text extraction
                // In a real application, you would use a proper document parsing library
                extractedText = await simulateDocExtraction(file);
            }

            updateProgress(30, 'Text extraction completed...');
        }

        async function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                fileReader.onload = async function() {
                    try {
                        const typedarray = new Uint8Array(this.result);
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        let fullText = '';

                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            fullText += pageText + '\n';
                        }

                        resolve(fullText);
                    } catch (error) {
                        reject(error);
                    }
                };
                fileReader.readAsArrayBuffer(file);
            });
        }

        async function simulateDocExtraction(file) {
            // Simulate document text extraction
            // In a real application, you would use libraries like mammoth.js for DOCX
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(`Sample extracted text from ${file.name}. This would contain the actual policy content in a real implementation.`);
                }, 1000);
            });
        }

        async function analyzeDocument(text) {
    updateProgress(40, 'Validating document type...');
    await sleep(1000);
    
    // First validate if it's a policy document
    const isValidPolicy = validatePolicyDocument(text);
    if (!isValidPolicy) {
        updateProgress(100, 'Document validation failed!');
        await sleep(500);
        showInvalidDocumentError();
        return;
    }

    updateProgress(55, 'Analyzing policy structure...');
    await sleep(1000);

    updateProgress(70, 'Identifying coverage areas...');
    await sleep(1000);

    updateProgress(85, 'Calculating risk scores...');
    await sleep(1000);

    updateProgress(95, 'Generating recommendations...');
    await sleep(1000);

    // Perform actual analysis based on extracted text
    analysisResults = performRealAnalysis(text);

    updateProgress(100, 'Analysis complete!');
    await sleep(500);
}

       function performRealAnalysis(text) {
    const analysis = {
        policyType: detectPolicyType(text),
        sumInsured: extractSumInsured(text),
        premium: extractPremium(text), // Fixed function name
        coverageAreas: identifyCoverageAreas(text),
        exclusions: identifyExclusions(text),
        riskScore: calculateRiskScore(text),
        gaps: identifyGaps(text),
        recommendations: generateRecommendations(text),
        isValidPolicy: validatePolicyDocument(text) // Add this new function
    };
    return analysis;
}

        function detectPolicyType(text) {
            const lowerText = text.toLowerCase();
            if (lowerText.includes('health') || lowerText.includes('medical')) return 'Health Insurance';
            if (lowerText.includes('life') || lowerText.includes('term')) return 'Life Insurance';
            if (lowerText.includes('motor') || lowerText.includes('vehicle') || lowerText.includes('car')) return 'Motor Insurance';
            if (lowerText.includes('home') || lowerText.includes('property')) return 'Home Insurance';
            return 'General Insurance';
        }

        function extractSumInsured(text) {
            // Extract sum insured using regex patterns
            const patterns = [
                /sum insured[:\s]*₹?[\s]*([0-9,]+)/i,
                /coverage amount[:\s]*₹?[\s]*([0-9,]+)/i,
                /insured amount[:\s]*₹?[\s]*([0-9,]+)/i
            ];

            for (let pattern of patterns) {
                const match = text.match(pattern);
                if (match) {
                    return `₹${match[1]}`;
                }
            }
            return 'Not specified';
        }

        function extractPremium(text) {
            // Extract premium using regex patterns
            const patterns = [
                /premium[:\s]*₹?[\s]*([0-9,]+)/i,
                /annual premium[:\s]*₹?[\s]*([0-9,]+)/i,
                /total premium[:\s]*₹?[\s]*([0-9,]+)/i
            ];

            for (let pattern of patterns) {
                const match = text.match(pattern);
                if (match) {
                    return `₹${match[1]}`;
                }
            }
            return 'Not specified';
        }

        function identifyCoverageAreas(text) {
            const coverageKeywords = [
                'accidental death', 'disability', 'hospitalization', 'surgery',
                'ambulance', 'pre-existing', 'maternity', 'dental', 'optical',
                'theft', 'fire', 'flood', 'earthquake', 'third party liability'
            ];

            const foundCoverage = [];
            const lowerText = text.toLowerCase();

            coverageKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    foundCoverage.push(keyword.charAt(0).toUpperCase() + keyword.slice(1));
                }
            });

            return foundCoverage.length > 0 ? foundCoverage : ['Basic coverage identified'];
        }

        function identifyExclusions(text) {
            const exclusionKeywords = [
                'excluded', 'not covered', 'exception', 'limitation',
                'pre-existing condition', 'self-inflicted', 'experimental treatment',
                'cosmetic surgery', 'war', 'nuclear'
            ];

            const foundExclusions = [];
            const lowerText = text.toLowerCase();

            exclusionKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    foundExclusions.push(keyword.charAt(0).toUpperCase() + keyword.slice(1));
                }
            });

            return foundExclusions.length > 0 ? foundExclusions : ['Standard exclusions apply'];
        }

        function calculateRiskScore(text) {
            let score = 50; // Base score
            const lowerText = text.toLowerCase();

            // Positive factors (reduce risk)
            if (lowerText.includes('comprehensive')) score -= 10;
            if (lowerText.includes('cashless')) score -= 5;
            if (lowerText.includes('no claim bonus')) score -= 5;
            if (lowerText.includes('lifetime renewal')) score -= 10;

            // Negative factors (increase risk)
            if (lowerText.includes('waiting period')) score += 10;
            if (lowerText.includes('co-payment')) score += 5;
            if (lowerText.includes('sub-limit')) score += 15;
            if (lowerText.includes('exclusion')) score += 10;

            return Math.max(0, Math.min(100, score));
        }

        function identifyGaps(text) {
            const gaps = [];
            const lowerText = text.toLowerCase();

            if (!lowerText.includes('maternity')) gaps.push('Maternity coverage not mentioned');
            if (!lowerText.includes('mental health')) gaps.push('Mental health coverage unclear');
            if (!lowerText.includes('day care')) gaps.push('Day care procedures not specified');
            if (!lowerText.includes('ambulance')) gaps.push('Ambulance coverage not mentioned');

            return gaps.length > 0 ? gaps : ['No major gaps identified'];
        }

        function generateRecommendations(text) {
            const recommendations = [];
            const lowerText = text.toLowerCase();

            if (lowerText.includes('co-payment')) {
                recommendations.push('Consider policies with no co-payment for better coverage');
            }
            if (lowerText.includes('sub-limit')) {
                recommendations.push('Look for policies without sub-limits for comprehensive protection');
            }
            if (!lowerText.includes('cashless')) {
                recommendations.push('Ensure your policy offers cashless treatment facilities');
            }
            if (lowerText.includes('waiting period')) {
                recommendations.push('Check if waiting periods can be reduced with additional premium');
            }

            if (recommendations.length === 0) {
                recommendations.push('Your policy appears to have good coverage terms');
                recommendations.push('Consider increasing sum insured if needed');
                recommendations.push('Review policy annually for any changes');
            }

            return recommendations;
        }
        function validatePolicyDocument(text) {
    const lowerText = text.toLowerCase();
    const policyIndicators = [
        'policy number', 'policy no', 'certificate number', 'certificate no',
        'insured person', 'policyholder',  'sum insured', 'premium amount',
        'coverage', 'deductible', 'beneficiary', 'terms and conditions',
        'insurance company', 'insurer', 'underwriter'
    ];
    
    let indicatorCount = 0;
    policyIndicators.forEach(indicator => {
        if (lowerText.includes(indicator)) {
            indicatorCount++;
        }
    });
    
    // If at least 3 policy-related terms are found, consider it a valid policy
    return indicatorCount >= 3;
}

        function updateProgress(percent, message) {
            progressFill.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            progressText.textContent = message;
        }

        function showResults() {
            analysisSection.classList.remove('active');
            resultsSection.classList.add('active');
            resultsSection.classList.add('fade-in');

            // Update risk score display
            const riskScore = analysisResults.riskScore || 50;
            const riskElement = document.getElementById('riskScore');
            const riskValue = document.getElementById('riskValue');
            const riskDescription = document.getElementById('riskDescription');

            riskValue.textContent = riskScore;

            if (riskScore <= 30) {
                riskElement.className = 'risk-score risk-low';
                riskDescription.textContent = 'Low Risk - Excellent Coverage';
            } else if (riskScore <= 60) {
                riskElement.className = 'risk-score risk-medium';
                riskDescription.textContent = 'Medium Risk - Good Coverage with Room for Improvement';
            } else {
                riskElement.className = 'risk-score risk-high';
                riskDescription.textContent = 'High Risk - Coverage Needs Attention';
            }

            // Populate result cards
            populateResultCards();
            saveDocument(currentFile, analysisResults);
        }

        function populateResultCards() {
            // Policy Overview
            const policyOverview = document.getElementById('policyOverview');
            policyOverview.innerHTML = `
                <div class="analysis-item">
                    <div class="analysis-label">Policy Type</div>
                    <div class="analysis-value">${analysisResults.policyType || 'Not detected'}</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Sum Insured</div>
                    <div class="analysis-value highlight">${analysisResults.sumInsured || 'Not specified'}</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Premium</div>
                    <div class="analysis-value highlight">${analysisResults.premium || 'Not specified'}</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Document Length</div>
                    <div class="analysis-value">${extractedText.length} characters analyzed</div>
                </div>
            `;

            // Coverage Analysis
            const coverageAnalysis = document.getElementById('coverageAnalysis');
            const coverageItems = analysisResults.coverageAreas || [];
            coverageAnalysis.innerHTML = `
                <div class="analysis-item">
                    <div class="analysis-label">Identified Coverage Areas</div>
                    <div class="analysis-value">
                        ${coverageItems.map(item => `<span class="highlight">• ${item}</span>`).join('<br>')}
                    </div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Coverage Scope</div>
                    <div class="analysis-value">${coverageItems.length} coverage areas identified</div>
                </div>
            `;

            // Risk Assessment
            const riskAssessment = document.getElementById('riskAssessment');
            const gaps = analysisResults.gaps || [];
            const exclusions = analysisResults.exclusions || [];
            riskAssessment.innerHTML = `
                <div class="analysis-item">
                    <div class="analysis-label">Coverage Gaps</div>
                    <div class="analysis-value">
                        ${gaps.map(gap => `<span class="text-warning">• ${gap}</span>`).join('<br>')}
                    </div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Key Exclusions</div>
                    <div class="analysis-value">
                        ${exclusions.map(exclusion => `<span class="text-danger">• ${exclusion}</span>`).join('<br>')}
                    </div>
                </div>
            `;

            // Recommendations
            const recommendations = document.getElementById('recommendations');
            const recs = analysisResults.recommendations || [];
            recommendations.innerHTML = `
                <div class="analysis-item">
                    <div class="analysis-label">AI-Generated Recommendations</div>
                    <div class="analysis-value">
                        ${recs.map((rec, index) => `<span class="text-success">${index + 1}. ${rec}</span>`).join('<br><br>')}
                    </div>
                </div>
            `;

            // Key Terms
            const keyTerms = document.getElementById('keyTerms');
            keyTerms.innerHTML = `
                <div class="analysis-item">
                    <div class="analysis-label">Important Terms Identified</div>
                    <div class="analysis-value">
                        <span class="highlight">• Policy Effective Date</span><br>
                        <span class="highlight">• Claim Settlement Process</span><br>
                        <span class="highlight">• Renewal Conditions</span><br>
                        <span class="highlight">• Grace Period</span>
                    </div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Critical Clauses</div>
                    <div class="analysis-value">Review sections with waiting periods and exclusions carefully</div>
                </div>
            `;

            // Financial Analysis
            const financialAnalysis = document.getElementById('financialAnalysis');
            const premium = analysisResults.premium || 'Not specified';
            const sumInsured = analysisResults.sumInsured || 'Not specified';
            financialAnalysis.innerHTML = `
                <div class="analysis-item">
                    <div class="analysis-label">Premium Analysis</div>
                    <div class="analysis-value">
                        Annual Premium: <span class="highlight">${premium}</span>
                    </div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Value Assessment</div>
                    <div class="analysis-value">
                        Coverage Amount: <span class="highlight">${sumInsured}</span>
                    </div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-label">Cost Efficiency</div>
                    <div class="analysis-value text-success">Analysis based on identified terms and conditions</div>
                </div>
            `;
        }

        function resetAnalysis() {
            // Reset all variables
            currentFile = null;
            extractedText = '';
            analysisResults = {};

            // Reset UI
            fileInfo.classList.remove('active');
            analysisSection.classList.remove('active');
            resultsSection.classList.remove('active');
            document.querySelector('.upload-section').style.display = 'block';
            
            // Reset progress
            progressFill.style.width = '0%';
            progressPercent.textContent = '0%';
            progressText.textContent = 'Initializing analysis...';
            
            // Clear file input
            fileInput.value = '';
            
            // Hide errors
            hideError();

            // Smooth scroll to upload section
            document.getElementById('analyze').scrollIntoView({ behavior: 'smooth' });
        }

        function downloadReport() {
            // Generate and download a report
            const reportContent = generateReportContent();
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `insurance-analysis-report-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
function saveDocument(file, analysis) {
    const docData = {
        id: Date.now(),
        fileName: file.name,
        fileSize: file.size,
        fileType: file.type,
        uploadDate: new Date().toISOString(),
        analysis: analysis,
        textExtract: extractedText.substring(0, 1000) // Store first 1000 chars
    };
    
    storedDocuments.unshift(docData); // Add to beginning
    
    // Keep only last 50 documents
    if (storedDocuments.length > 50) {
        storedDocuments = storedDocuments.slice(0, 50);
    }
    
    localStorage.setItem('insuregpt-documents', JSON.stringify(storedDocuments));
}
        function generateReportContent() {
            const date = new Date().toLocaleDateString();
            return `
INSURANCE POLICY ANALYSIS REPORT
Generated by InsureGPT
Date: ${date}

===========================================

POLICY OVERVIEW
- Policy Type: ${analysisResults.policyType || 'Not detected'}
- Sum Insured: ${analysisResults.sumInsured || 'Not specified'}
- Premium: ${analysisResults.premium || 'Not specified'}
- Risk Score: ${analysisResults.riskScore || 'N/A'}/100

COVERAGE AREAS
${(analysisResults.coverageAreas || []).map(area => `- ${area}`).join('\n')}

IDENTIFIED GAPS
${(analysisResults.gaps || []).map(gap => `- ${gap}`).join('\n')}

KEY EXCLUSIONS
${(analysisResults.exclusions || []).map(exclusion => `- ${exclusion}`).join('\n')}

AI RECOMMENDATIONS
${(analysisResults.recommendations || []).map((rec, index) => `${index + 1}. ${rec}`).join('\n')}

===========================================

DISCLAIMER: This analysis is generated by AI and should be reviewed by insurance professionals for accuracy. Please consult with qualified insurance advisors before making policy decisions.

Generated by InsureGPT - Real AI Insurance Analysis
            `.trim();
        }

        // Utility function
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Update active nav link on scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-links a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (scrollY >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });

        // Initialize the application
        window.addEventListener('load', function() {
            console.log('InsureGPT loaded successfully');
        });
    </script>
</body>
</html>
